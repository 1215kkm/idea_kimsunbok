<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ë‹¤ëœë“œ ì‹œë®¬ë ˆì´ì…˜ - 120%ì˜ ë§ˆë²•</title>
<style>
*{margin:0;padding:0;box-sizing:border-box;}
body{font-family:'Segoe UI',sans-serif;background:#0a0a2e;color:#fff;overflow-x:hidden;min-height:100vh;}

/* ===== ì¸íŠ¸ë¡œ ===== */
#intro{position:fixed;inset:0;background:linear-gradient(135deg,#0a0a2e,#1a1a4e,#0a0a2e);
display:flex;flex-direction:column;align-items:center;justify-content:center;z-index:1000;transition:opacity 0.8s;}
#intro.hide{opacity:0;pointer-events:none;}
#intro .sub{font-size:1.1rem;color:#888;margin-bottom:8px;letter-spacing:2px;}
#intro h1{font-size:4rem;font-weight:900;background:linear-gradient(90deg,#00d4ff,#7b2ff7,#ff6b6b);
-webkit-background-clip:text;-webkit-text-fill-color:transparent;margin-bottom:12px;}
#intro p{font-size:1.2rem;color:#aaa;margin-bottom:40px;}
.btn-start{padding:18px 60px;font-size:1.2rem;font-weight:700;background:linear-gradient(135deg,#7b2ff7,#00d4ff);
border:none;border-radius:50px;color:#fff;cursor:pointer;box-shadow:0 0 40px rgba(123,47,247,0.4);transition:transform 0.2s;}
.btn-start:hover{transform:scale(1.08);}

/* ===== ê²Œì„ í™”ë©´ ===== */
#game{display:none;}
#game.on{display:block;}

/* ìƒë‹¨ë°” */
.topbar{background:rgba(15,15,50,0.95);padding:15px 30px;display:flex;align-items:center;justify-content:space-between;
border-bottom:2px solid rgba(123,47,247,0.3);position:sticky;top:0;z-index:50;}
.topbar .logo{font-size:1.3rem;font-weight:900;color:#7b2ff7;letter-spacing:1px;}
.topbar .info{display:flex;gap:25px;font-size:0.9rem;}
.topbar .info div span{color:#777;}
.topbar .info div b{color:#00d4ff;font-size:1.05rem;}

/* ìŠ¤í† ë¦¬ ë‚´ë ˆì´ì…˜ */
.narration{background:linear-gradient(135deg,rgba(20,20,60,0.9),rgba(10,10,40,0.9));
border:1px solid rgba(123,47,247,0.2);border-radius:16px;margin:20px 30px;padding:25px 30px;
font-size:1.05rem;line-height:1.8;color:#ccc;position:relative;}
.narration .speaker{color:#7b2ff7;font-weight:700;font-size:0.85rem;margin-bottom:8px;letter-spacing:1px;}
.narration em{color:#00d4ff;font-style:normal;font-weight:600;}

/* ë§ˆì„ */
.town{display:flex;gap:15px;padding:20px 30px;overflow-x:auto;justify-content:center;flex-wrap:wrap;}
.store{background:rgba(25,25,65,0.8);border:2px solid rgba(123,47,247,0.15);border-radius:20px;
padding:25px 20px;text-align:center;cursor:pointer;transition:all 0.3s;min-width:140px;flex:1;max-width:180px;}
.store:hover{transform:translateY(-8px);border-color:#7b2ff7;box-shadow:0 10px 30px rgba(123,47,247,0.3);}
.store.done{opacity:0.35;pointer-events:none;border-color:#333;}
.store .icon{font-size:3rem;display:block;margin-bottom:8px;}
.store .name{font-weight:700;font-size:0.95rem;margin-bottom:4px;}
.store .price{color:#ffcc00;font-size:0.8rem;}

/* ìºë¦­í„° ë°” */
.char-bar{display:flex;align-items:center;justify-content:center;gap:15px;padding:10px 30px;margin-bottom:5px;}
.char-bar .avatar{font-size:2.5rem;}
.char-bar .say{background:rgba(123,47,247,0.15);padding:8px 18px;border-radius:20px;font-size:0.9rem;color:#ccc;max-width:400px;}

/* ì‚¬ì´ë“œ íŒ¨ë„ */
.panels{display:grid;grid-template-columns:1fr 1fr;gap:15px;padding:0 30px 20px;}
.panel{background:rgba(20,20,55,0.8);border:1px solid rgba(123,47,247,0.15);border-radius:16px;padding:20px;}
.panel h3{font-size:0.8rem;color:#7b2ff7;letter-spacing:1px;margin-bottom:10px;text-transform:uppercase;}
.wallet-big{font-size:2.5rem;font-weight:900;background:linear-gradient(90deg,#00d4ff,#7b2ff7);
-webkit-background-clip:text;-webkit-text-fill-color:transparent;}
.wallet-sub{font-size:0.8rem;color:#666;margin-top:3px;}
.bar-track{height:8px;background:rgba(255,255,255,0.08);border-radius:4px;margin-top:10px;overflow:hidden;}
.bar-fill{height:100%;border-radius:4px;background:linear-gradient(90deg,#00d4ff,#7b2ff7,#ff6b6b);transition:width 1s;}
.history-item{display:flex;justify-content:space-between;padding:6px 0;border-bottom:1px solid rgba(255,255,255,0.04);font-size:0.82rem;}
.history-item .h-place{color:#aaa;}
.history-item .h-spent{color:#ff6b6b;}
.history-item .h-earn{color:#00ff88;font-weight:700;}

/* ===== ê²°ì œ ëª¨ë‹¬ ===== */
.overlay{position:fixed;inset:0;background:rgba(0,0,0,0.75);display:none;align-items:center;justify-content:center;
z-index:200;backdrop-filter:blur(6px);}
.overlay.on{display:flex;}
.modal{background:linear-gradient(135deg,#1a1a4e,#0d0d30);border:1px solid rgba(123,47,247,0.4);
border-radius:24px;padding:40px;text-align:center;min-width:380px;box-shadow:0 0 60px rgba(123,47,247,0.25);}
.modal .m-icon{font-size:4rem;margin-bottom:5px;}
.modal h2{font-size:1.6rem;margin-bottom:3px;}
.modal .m-item{color:#888;font-size:0.9rem;margin-bottom:15px;}
.modal .m-price{font-size:2.8rem;font-weight:900;color:#ff6b6b;margin:10px 0;}
.modal .m-price small{font-size:1rem;color:#888;}
.btn-pay{padding:14px 45px;font-size:1.05rem;font-weight:700;background:linear-gradient(135deg,#7b2ff7,#00d4ff);
border:none;border-radius:50px;color:#fff;cursor:pointer;transition:transform 0.2s;margin-right:8px;}
.btn-pay:hover{transform:scale(1.05);}
.btn-cancel{padding:12px 30px;font-size:0.9rem;background:transparent;border:1px solid #555;
border-radius:50px;color:#888;cursor:pointer;}

/* ===== ì ë¦½ ì• ë‹ˆë©”ì´ì…˜ ===== */
.result-overlay{position:fixed;inset:0;background:rgba(0,0,0,0.88);display:none;align-items:center;
justify-content:center;z-index:300;backdrop-filter:blur(10px);}
.result-overlay.on{display:flex;}
.result{text-align:center;max-width:500px;}
.r-line{font-size:1rem;color:#777;margin:6px 0;opacity:0;transform:translateY(15px);transition:all 0.5s;}
.r-line.show{opacity:1;transform:translateY(0);}
.r-line.hl{color:#00d4ff;font-weight:700;font-size:1.15rem;}
.r-big{font-size:5rem;font-weight:900;background:linear-gradient(90deg,#00ff88,#00d4ff);
-webkit-background-clip:text;-webkit-text-fill-color:transparent;margin:20px 0 8px;
opacity:0;transform:scale(0.5);transition:all 0.7s cubic-bezier(0.17,0.89,0.32,1.28);}
.r-big.show{opacity:1;transform:scale(1);}
.r-badge{display:inline-block;font-size:1.6rem;font-weight:900;background:linear-gradient(135deg,#ff6b6b,#ff8e53);
padding:8px 28px;border-radius:50px;opacity:0;transform:scale(0);transition:all 0.5s cubic-bezier(0.17,0.89,0.32,1.28);}
.r-badge.show{opacity:1;transform:scale(1);}
.r-detail{font-size:0.9rem;color:#888;margin:4px 0;opacity:0;transition:opacity 0.4s;}
.r-detail.show{opacity:1;}
.r-detail strong{color:#fff;}
.btn-next{margin-top:30px;padding:14px 45px;font-size:1rem;font-weight:600;background:rgba(123,47,247,0.25);
border:1px solid #7b2ff7;border-radius:50px;color:#fff;cursor:pointer;opacity:0;transition:opacity 0.5s;}
.btn-next.show{opacity:1;}
.btn-next:hover{background:rgba(123,47,247,0.45);}

/* íŒŒí‹°í´ */
.particle{position:fixed;pointer-events:none;z-index:400;font-size:1.5rem;
animation:floatUp 2s ease-out forwards;}
@keyframes floatUp{0%{opacity:1;transform:translateY(0) scale(1);}100%{opacity:0;transform:translateY(-180px) scale(0.3);}}

/* ===== ì—”ë”© ===== */
#ending{position:fixed;inset:0;background:linear-gradient(135deg,#0a0a2e,#1a1a4e);
display:none;flex-direction:column;align-items:center;justify-content:center;z-index:500;text-align:center;padding:30px;}
#ending.on{display:flex;}
#ending h1{font-size:2.6rem;font-weight:900;margin-bottom:25px;
background:linear-gradient(90deg,#00d4ff,#7b2ff7,#ff6b6b);-webkit-background-clip:text;-webkit-text-fill-color:transparent;}
.sum-grid{display:grid;grid-template-columns:1fr 1fr;gap:15px;margin:15px 0;}
.sum-card{background:rgba(25,25,65,0.8);border:1px solid rgba(123,47,247,0.3);border-radius:16px;padding:22px;min-width:180px;}
.sum-card .label{font-size:0.8rem;color:#777;}
.sum-card .val{font-size:2rem;font-weight:900;margin-top:5px;}
.sum-card .val.c1{color:#ff6b6b;}.sum-card .val.c2{color:#00ff88;}.sum-card .val.c3{color:#00d4ff;}.sum-card .val.c4{color:#7b2ff7;}
#ending .quote{font-size:1.1rem;color:#999;margin-top:25px;line-height:1.7;max-width:480px;font-style:italic;}
.btn-restart{margin-top:25px;padding:15px 50px;font-size:1.1rem;font-weight:700;
background:linear-gradient(135deg,#7b2ff7,#00d4ff);border:none;border-radius:50px;color:#fff;cursor:pointer;}
</style>
</head>
<body>

<!-- ì¸íŠ¸ë¡œ -->
<div id="intro">
  <div class="sub">ë¹„ì„ í˜•ê³µì‹ ì²´í—˜ ì‹œë®¬ë ˆì´ì…˜</div>
  <h1>ë‹¤ëœë“œ</h1>
  <p>ì“¸ìˆ˜ë¡ ìŒ“ì´ëŠ” 120%ì˜ ë§ˆë²•ì„ ì§ì ‘ ì²´í—˜í•˜ì„¸ìš”</p>
  <button class="btn-start" onclick="startGame()">ì‹œë®¬ë ˆì´ì…˜ ì‹œì‘</button>
</div>

<!-- ê²Œì„ -->
<div id="game">
  <div class="topbar">
    <div class="logo">DATALAND</div>
    <div class="info">
      <div><span>í˜„ê¸ˆ </span><b id="s-cash">50,000ì›</b></div>
      <div><span>í¬ì¸íŠ¸ </span><b id="s-pts">0P</b></div>
      <div><span>ë°©ë¬¸ </span><b id="s-visit">0 / 5</b></div>
    </div>
  </div>

  <!-- ë‚´ë ˆì´ì…˜ -->
  <div class="narration" id="narration">
    <div class="speaker">ë‚´ë ˆì´í„°</div>
    <div id="nar-text">
      ì›”ìš”ì¼ ì•„ì¹¨. <em>ë°•ì˜í¬(28ì„¸)</em>ëŠ” ì¶œê·¼ê¸¸ì— í•œìˆ¨ì„ ì‰¬ì—ˆë‹¤.<br>
      "ë§¤ì¼ ì“°ëŠ” ëˆì€ ê·¸ëƒ¥ ì‚¬ë¼ì§€ê¸°ë§Œ í•˜ëŠ”ë°..."<br><br>
      ê·¸ë•Œ, ë™ë£Œê°€ ë§í–ˆë‹¤. <em>"ë‹¤ëœë“œ ì¨ë´¤ì–´? ì“´ ëˆì˜ 120%ê°€ ëŒì•„ì˜¨ëŒ€."</em><br>
      ë°˜ì‹ ë°˜ì˜í•˜ë©° ì•±ì„ ê¹”ì•˜ë‹¤. ì´ì œ ì§ì ‘ ì²´í—˜í•´ ë³´ì.
    </div>
  </div>

  <!-- ìºë¦­í„° -->
  <div class="char-bar">
    <div class="avatar">ğŸ‘©</div>
    <div class="say" id="char-say">ê°€ë§¹ì ì„ í´ë¦­í•´ì„œ ë°©ë¬¸í•´ ë³´ì„¸ìš”!</div>
  </div>

  <!-- ë§ˆì„ -->
  <div class="town" id="town">
    <div class="store" onclick="visit(this)" data-key="super" data-name="í–‰ë³µí•œ ìŠˆí¼" data-icon="ğŸª" data-price="32000" data-item="ì¥ë³´ê¸° (ì‚¬ê³¼, ìš°ìœ , ê³ ê¸°)">
      <span class="icon">ğŸª</span><div class="name">í–‰ë³µí•œ ìŠˆí¼</div><div class="price">ì¥ë³´ê¸° 32,000ì›</div>
    </div>
    <div class="store" onclick="visit(this)" data-key="cafe" data-name="ë‹¤ëœë“œ ì¹´í˜" data-icon="â˜•" data-price="4500" data-item="ì•„ë©”ë¦¬ì¹´ë…¸ + ì¼€ì´í¬">
      <span class="icon">â˜•</span><div class="name">ë‹¤ëœë“œ ì¹´í˜</div><div class="price">ì»¤í”¼ì„¸íŠ¸ 4,500ì›</div>
    </div>
    <div class="store" onclick="visit(this)" data-key="gas" data-name="ì£¼ìœ ì†Œ" data-icon="â›½" data-price="70000" data-item="íœ˜ë°œìœ  ê°€ë“ ì£¼ìœ ">
      <span class="icon">â›½</span><div class="name">ì£¼ìœ ì†Œ</div><div class="price">ì£¼ìœ  70,000ì›</div>
    </div>
    <div class="store" onclick="visit(this)" data-key="pharm" data-name="ê±´ê°• ì•½êµ­" data-icon="ğŸ’Š" data-price="8000" data-item="ë¹„íƒ€ë¯¼ + ë§ˆìŠ¤í¬">
      <span class="icon">ğŸ’Š</span><div class="name">ê±´ê°• ì•½êµ­</div><div class="price">ë¹„íƒ€ë¯¼ 8,000ì›</div>
    </div>
    <div class="store" onclick="visit(this)" data-key="rest" data-name="ë§›ìˆëŠ” ì‹ë‹¹" data-icon="ğŸ½ï¸" data-price="25000" data-item="ê°€ì¡± ì™¸ì‹ (ê¹€ì¹˜ì°Œê°œ 4ì¸)">
      <span class="icon">ğŸ½ï¸</span><div class="name">ë§›ìˆëŠ” ì‹ë‹¹</div><div class="price">ì™¸ì‹ 25,000ì›</div>
    </div>
  </div>

  <!-- í•˜ë‹¨ íŒ¨ë„ -->
  <div class="panels">
    <div class="panel">
      <h3>ë‚´ ì§€ê°‘</h3>
      <div class="wallet-big" id="w-pts">0 P</div>
      <div class="wallet-sub">ëˆ„ì  ì ë¦½ í¬ì¸íŠ¸</div>
      <div style="margin-top:12px;font-size:0.85rem;color:#666;">í‰ê·  ì ë¦½ë¥ </div>
      <div style="font-size:1.8rem;font-weight:900;color:#00ff88;" id="w-rate">-</div>
      <div class="bar-track"><div class="bar-fill" id="w-bar" style="width:0%"></div></div>
    </div>
    <div class="panel">
      <h3>ê²°ì œ ë‚´ì—­</h3>
      <div id="history">
        <div style="font-size:0.82rem;color:#444;padding:15px 0;text-align:center;">ì•„ì§ ê²°ì œ ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤</div>
      </div>
    </div>
  </div>
</div>

<!-- ê²°ì œ ëª¨ë‹¬ -->
<div class="overlay" id="payModal">
  <div class="modal">
    <div class="m-icon" id="m-icon"></div>
    <h2 id="m-name"></h2>
    <div class="m-item" id="m-item"></div>
    <div class="m-price" id="m-price"></div>
    <div>
      <button class="btn-pay" onclick="pay()">ë‹¤ëœë“œë¡œ ê²°ì œ</button>
      <button class="btn-cancel" onclick="closeModal()">ì·¨ì†Œ</button>
    </div>
  </div>
</div>

<!-- ì ë¦½ ì• ë‹ˆë©”ì´ì…˜ -->
<div class="result-overlay" id="resultOv">
  <div class="result" id="resultBox"></div>
</div>

<!-- ì—”ë”© -->
<div id="ending">
  <h1>ì˜í¬ì˜ í•˜ë£¨ - ì‹œë®¬ë ˆì´ì…˜ ì™„ë£Œ!</h1>
  <div class="sum-grid" id="sumGrid"></div>
  <div class="quote" id="endQuote"></div>
  <button class="btn-restart" onclick="location.reload()">ë‹¤ì‹œ ì²´í—˜í•˜ê¸°</button>
</div>

<script>
/* ===== ìƒíƒœ ===== */
const S = { cash:50000, pts:0, spent:0, earned:0, visits:0, total:5, hist:[], cur:null };

const stories = {
  super: { before:'ì˜í¬ëŠ” í‡´ê·¼ í›„ ìŠˆí¼ì— ë“¤ë €ë‹¤.\n"ì˜¤ëŠ˜ ì €ë…ì€ ë­˜ í•´ë¨¹ì§€... ì¥ë°”êµ¬ë‹ˆì— ì‚¬ê³¼, ìš°ìœ , ê³ ê¸°ë¥¼ ë„£ì—ˆë‹¤."', after:'"32,000ì›ì´ë‚˜ ì¼ëŠ”ë°... 38,400í¬ì¸íŠ¸?!\nì¥ë³¼ ë•Œë§ˆë‹¤ 6,400ì›ì´ ë¤ìœ¼ë¡œ?!"' },
  cafe: { before:'ì¶œê·¼ê¸¸, ëŠ˜ ê°€ë˜ ì¹´í˜ ì•ì— ë©ˆì¶° ì„°ë‹¤.\n"ì˜¤ëŠ˜ë„ ì•„ë©”ë¦¬ì¹´ë…¸ í•œ ì”... ìŠµê´€ì²˜ëŸ¼."', after:'"ì»¤í”¼ê°’ 4,500ì›ì— 5,400í¬ì¸íŠ¸ë¼ë‹ˆ.\në§¤ì¼ ë§ˆì‹œëŠ” ì»¤í”¼ê°€ ì˜¤íˆë ¤ ëˆì„ ë§Œë“¤ì–´ì£¼ë„¤?"' },
  gas: { before:'ì£¼ìœ  ê²½ê³ ë“±ì´ ì¼œì¡Œë‹¤.\n"ê¸°ë¦„ê°’ì´ ë˜ ì˜¬ëë„¤... ê°€ë“ ì±„ìš°ë©´ 7ë§Œì›ì´ë‹¤."', after:'"7ë§Œì› ì£¼ìœ í–ˆëŠ”ë° 84,000í¬ì¸íŠ¸?!\nê¸°ë¦„ê°’ ë¶€ë‹´ì´ í™• ì¤„ì—ˆë‹¤!"' },
  pharm: { before:'í™˜ì ˆê¸°ë¼ ë¹„íƒ€ë¯¼ì„ ì‚¬ëŸ¬ ì•½êµ­ì— ë“¤ë €ë‹¤.\n"ê±´ê°•ì€ ì±™ê²¨ì•¼ì§€."', after:'"8,000ì›ì— 9,600í¬ì¸íŠ¸.\nì•½êµ­ë¹„ë„ 120% ëŒë ¤ë°›ë‹¤ë‹ˆ, ê±´ê°•ë„ ì±™ê¸°ê³  ëˆë„ ì±™ê¸°ê³ !"' },
  rest: { before:'ì£¼ë§, ê°€ì¡±ê³¼ ì™¸ì‹ì„ ë‚˜ì™”ë‹¤.\n"ì• ë“¤ì´ ê¹€ì¹˜ì°Œê°œ ë¨¹ê³  ì‹¶ëŒ€. 4ì¸ë¶„ì´ë©´ 25,000ì›..."', after:'"ì™¸ì‹ë¹„ 25,000ì› â†’ 30,000í¬ì¸íŠ¸!\nê°€ì¡±ê³¼ì˜ ì‹œê°„ì— ë³´ë„ˆìŠ¤ê°€ ë¶™ë‹¤ë‹ˆ."' }
};

/* ===== ì¸íŠ¸ë¡œ â†’ ê²Œì„ ===== */
function startGame(){
  document.getElementById('intro').classList.add('hide');
  setTimeout(()=>document.getElementById('game').classList.add('on'),500);
}

/* ===== ê°€ë§¹ì  í´ë¦­ ===== */
function visit(el){
  if(el.classList.contains('done')) return;
  const d = el.dataset;
  const price = +d.price;
  if(S.cash < price){ alert('í˜„ê¸ˆì´ ë¶€ì¡±í•©ë‹ˆë‹¤!'); return; }
  S.cur = { el, key:d.key, name:d.name, icon:d.icon, price, item:d.item };

  // ë‚´ë ˆì´ì…˜ ë³€ê²½
  setNarration(stories[d.key].before);
  document.getElementById('char-say').textContent = d.name + 'ì— ì™”ì–´ìš”!';

  // ëª¨ë‹¬
  document.getElementById('m-icon').textContent = d.icon;
  document.getElementById('m-name').textContent = d.name;
  document.getElementById('m-item').textContent = d.item;
  document.getElementById('m-price').innerHTML = price.toLocaleString()+'ì› <small>ê²°ì œ</small>';
  document.getElementById('payModal').classList.add('on');
}

function closeModal(){ document.getElementById('payModal').classList.remove('on'); S.cur=null; }

/* ===== ê²°ì œ ===== */
function pay(){
  const c = S.cur;
  document.getElementById('payModal').classList.remove('on');

  S.cash -= c.price;
  const earned = Math.round(c.price * 1.2);
  const bonus = earned - c.price;
  S.pts += earned;
  S.spent += c.price;
  S.earned += earned;
  S.visits++;
  S.hist.push({ icon:c.icon, name:c.name, price:c.price, earned });
  c.el.classList.add('done');

  showResult(c, earned, bonus);
}

/* ===== ë¹„ì„ í˜•ê³µì‹ ì• ë‹ˆë©”ì´ì…˜ ===== */
function showResult(c, earned, bonus){
  const box = document.getElementById('resultBox');
  const sellerShare = (c.price * 0.5).toLocaleString();
  const consumerShare = (c.price * 0.5).toLocaleString();

  box.innerHTML = `
    <div class="r-line" data-d="0">${c.icon} ${c.name}</div>
    <div class="r-line" data-d="300" style="color:#aaa">"${c.item}"</div>
    <div class="r-line" data-d="700" style="font-size:1.6rem;color:#ff6b6b;font-weight:700">-${c.price.toLocaleString()}ì› ê²°ì œ</div>
    <div class="r-line" data-d="1200" style="color:#7b2ff7;font-size:1.1rem">
      â”€â”€ ë¹„ì„ í˜•ê³µì‹ ì‹¤í–‰ â”€â”€</div>
    <div class="r-line" data-d="1700">
      A1: ${c.price.toLocaleString()} x 50% = <b style="color:#ffcc00">${sellerShare}</b> (íŒë§¤ì ì ë¦½)</div>
    <div class="r-line" data-d="2200">
      B1: ${c.price.toLocaleString()} x 50% = <b style="color:#ffcc00">${consumerShare}</b> (ì†Œë¹„ì ì ë¦½)</div>
    <div class="r-line" data-d="2700">
      U:C1 x ë©¤ë²„ì‹­(10ë°°) x ë³´ì •ëª¨ë“œ ì ìš©</div>
    <div class="r-line hl" data-d="3200">
      ë³´ì •: 150% â†’ <b>120%</b> ì•ˆì „ ë³´ì • ì™„ë£Œ</div>
    <div class="r-big" data-d="3800">+${earned.toLocaleString()}P</div>
    <div class="r-badge" data-d="4400">120% ì ë¦½!</div>
    <div class="r-detail" data-d="4900">ì›ê¸ˆ <strong>${c.price.toLocaleString()}P</strong> + ë³´ë„ˆìŠ¤ <strong>${bonus.toLocaleString()}P</strong></div>
    <div class="r-detail" data-d="5200">ë‚´ ì´ í¬ì¸íŠ¸: <strong style="color:#00ff88">${S.pts.toLocaleString()}P</strong></div>
    <button class="btn-next" data-d="5700" onclick="closeResult()">
      ${S.visits < S.total ? 'ë‹¤ìŒ ê°€ë§¹ì  ë°©ë¬¸ â†’' : 'í•˜ë£¨ ì •ì‚° ë³´ê¸° â†’'}</button>
  `;

  document.getElementById('resultOv').classList.add('on');

  box.querySelectorAll('[data-d]').forEach(el=>{
    setTimeout(()=>{
      el.classList.add('show');
      if(el.classList.contains('r-big')) particles();
    }, +el.dataset.d);
  });
}

/* ===== íŒŒí‹°í´ ===== */
function particles(){
  const em = ['ğŸ’°','âœ¨','ğŸ‰','ğŸ’','ğŸª™','â­'];
  for(let i=0;i<12;i++){
    setTimeout(()=>{
      const p = document.createElement('div');
      p.className='particle';
      p.textContent=em[Math.floor(Math.random()*em.length)];
      p.style.left=(30+Math.random()*40)+'%';
      p.style.top=(35+Math.random()*25)+'%';
      document.body.appendChild(p);
      setTimeout(()=>p.remove(),2000);
    },i*80);
  }
}

/* ===== ê²°ê³¼ ë‹«ê¸° ===== */
function closeResult(){
  document.getElementById('resultOv').classList.remove('on');
  updateUI();
  setNarration(stories[S.cur.key].after);
  document.getElementById('char-say').textContent =
    S.visits < S.total ? `${S.visits}ê³³ ë°©ë¬¸ ì™„ë£Œ! ë‹¤ìŒì€ ì–´ë””ë¡œ?` : 'ì˜¤ëŠ˜ í•˜ë£¨ê°€ ëë‚¬ì–´ìš”!';
  S.cur = null;
  if(S.visits >= S.total) setTimeout(showEnding, 1200);
}

/* ===== UI ê°±ì‹  ===== */
function updateUI(){
  document.getElementById('s-cash').textContent = S.cash.toLocaleString()+'ì›';
  document.getElementById('s-pts').textContent = S.pts.toLocaleString()+'P';
  document.getElementById('s-visit').textContent = S.visits+' / '+S.total;
  document.getElementById('w-pts').textContent = S.pts.toLocaleString()+' P';

  const rate = S.spent > 0 ? Math.round(S.earned/S.spent*100) : 0;
  document.getElementById('w-rate').textContent = rate+'%';
  document.getElementById('w-bar').style.width = Math.min(rate,150)/1.5+'%';

  document.getElementById('history').innerHTML = S.hist.map(h=>
    `<div class="history-item">
      <span class="h-place">${h.icon} ${h.name}</span>
      <span class="h-spent">-${h.price.toLocaleString()}</span>
      <span class="h-earn">+${h.earned.toLocaleString()}P</span>
    </div>`
  ).join('');
}

/* ===== ë‚´ë ˆì´ì…˜ ===== */
function setNarration(text){
  document.getElementById('nar-text').innerHTML = text.replace(/\n/g,'<br>');
}

/* ===== ì—”ë”© ===== */
function showEnding(){
  const profit = S.earned - S.spent;
  document.getElementById('sumGrid').innerHTML = `
    <div class="sum-card"><div class="label">ì´ ì‚¬ìš© ê¸ˆì•¡</div><div class="val c1">${S.spent.toLocaleString()}ì›</div></div>
    <div class="sum-card"><div class="label">ì´ ì ë¦½ í¬ì¸íŠ¸</div><div class="val c2">${S.earned.toLocaleString()}P</div></div>
    <div class="sum-card"><div class="label">ìˆœì´ìµ (í¬ì¸íŠ¸ - í˜„ê¸ˆ)</div><div class="val c3">+${profit.toLocaleString()}P</div></div>
    <div class="sum-card"><div class="label">í‰ê·  ì ë¦½ë¥ </div><div class="val c4">120%</div></div>
  `;
  document.getElementById('endQuote').innerHTML = `
    "${S.spent.toLocaleString()}ì›ì„ ì¼ì§€ë§Œ,<br>${S.earned.toLocaleString()}í¬ì¸íŠ¸ê°€ ëŒì•„ì™”ìŠµë‹ˆë‹¤."<br><br>
    <span style="color:#7b2ff7;font-weight:700">í•­ì•„ë¦¬ ì†ì˜ ë¬¼ ì´ëŸ‰ì€ ê°™ë‹¤ â€” ë°”ê°€ì§€ë§Œ ë°”ë€” ë¿.</span><br>
    <span style="font-size:0.9rem">ì´ê²ƒì´ ë¹„ì„ í˜•ê³µì‹ì˜ ë§ˆë²•ì…ë‹ˆë‹¤.</span>
  `;
  document.getElementById('ending').classList.add('on');
}
</script>
</body>
</html>
